\RequirePackage{expl3}

\ProvidesExplPackage{mcclanahan}{2016/12/13}{1}{Collection of assorted utilities.}

%% includes
\usepackage{graphicx}
\usepackage{etextools}
\usepackage{geometry}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{tabu}
\usepackage{tabularx}
% \usepackage[table]{xcolor}
% \usepackage{xcolor}
% \usepackage{array}
\usepackage{enumitem}
\usepackage[affil-it]{authblk}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage[nottoc,notlot,notlof]{tocbibind}
\usepackage[toc,page]{appendix}
\usepackage{titlesec}
\usepackage{float}
\usepackage{pdfpages}
\usepackage{multirow}
\usepackage{pgfkeys,pgfcalendar}
\usepackage{color}
\usepackage{fancyvrb}
\usepackage{extsizes}
\usepackage{siunitx}
\usepackage{xifthen}
\usepackage{environ}
\usepackage{mathtools}
\usepackage{xparse}
\usepackage{trace}
\usepackage{xstring}
\usepackage{xpatch}

%% functions
% add link header before a paragraph
\newcommand{\linkheader}[1]{
  \begin{scriptsize}
    \url{#1}
  \end{scriptsize}}

\newcommand{\inlinelinkheader}[1]{\hspace{1pt} $|$ \linkheader{#1} \vspace{2pt}}

% get dates formatted as YYYY-MM-DD
\newcommand{\datewithdashes}{
  \usepackage[yyyymmdd]{datetime}
  \renewcommand{\dateseparator}{-}}

% tomorrow command (for things due tomorrow)
\newcount\pgfdatecount
\newcommand{\tomorrow}{
  \pgfcalendardatetojulian{\year-\month-\day+1}{\pgfdatecount}
  \pgfcalendarjuliantodate{\the\pgfdatecount}{\myyear}{\mymonth}{\myday}
  \pgfcalendarmonthname{\mymonth}\space\myday,\space\myyear}

% insert image as figure
\newcommand{\insertimageasfigure}[2]{
  \begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{#1}
    \caption{#2}
    \label{fig:#1}
  \end{figure}}
% same but taking up the rest of the page
\newcommand{\measurepage}{\dimexpr\pagegoal-\pagetotal-\baselineskip\relax}
% argument is number of lines
\newcommand{\captionheight}[2]{\dimexpr
  (\parskip)+(\abovecaptionskip)+(\belowcaptionskip)+(\baselineskip * #1)+#2}
\newcommand{\pageminuscaption}[2]{\dimexpr\measurepage-\captionheight{#1}{#2}}
\newcommand{\halftext}{\dimexpr.5\textwidth}
\newcommand{\includeforrestofpageornormal}[3]{
  \newlength{\picwid}
  \settowidth{\picwid}{\includegraphics[height=\pageminuscaption{#1}{#2},keepaspectratio]{#3}}
  \ifthenelse{
    \pageminuscaption{#1}{#2} < 0 \OR
    \picwid > \textwidth \OR
    \picwid < \halftext
  }{
    \includegraphics[width=\textwidth,keepaspectratio]{#3}
  }{
    \includegraphics[height=\pageminuscaption{#1}{#2},keepaspectratio]{#3}
  }
}
% second argument is number of lines of caption
\newcommand{\insertimageasfigurepage}[4][3pt]{
  \begin{figure}[H]
    \centering
    \includeforrestofpageornormal{#3}{#1}{#2}
    \caption{#4}
    \label{fig:#2}
  \end{figure}}
% same, but with dimensions
\newcommand{\insertimageasfigurewidth}[3]{
  \begin{figure}[H]
    \centering
    \includegraphics[width=#2,keepaspectratio]{#1}
    \caption{#3}
    \label{fig:#1}
  \end{figure}}
\newcommand{\insertimageasfiguredims}[4]{
  \begin{figure}[H]
    \centering
    \includegraphics[width=#2,height=#3,keepaspectratio]{#1}
    \caption{#4}
    \label{fig:#1}
  \end{figure}}

% add horizontal line splitting sections
\newcommand{\linesplit}{\noindent\rule{\textwidth}{1pt}}
\newcommand{\threeqlinesplit}{\noindent\rule{.75\textwidth}{1pt}}
\newcommand{\thinlinesplit}{\titlerule[0.2pt]\vspace{5pt}}

% format bibliography like a normal person
\newcommand{\formatbib}{\bibliographystyle{te}}

%% tabularx column types
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

% better sharp symbol
\newcommand{\bettersharp}{\resizebox{7pt}{10pt}{\textsuperscript{\sharp}}}
% better C++ formatting
\newcommand{\seeplusplus}{C\texttt{++}}

%% typesetting functions for my resume
\newcommand{\formatresume}{
  \geometry{
    a4paper,
    total={210mm,297mm},
    left=5mm,
    right=5mm,
    top=5mm,
    bottom=5mm}
  \pagenumbering{gobble}
  % \allsectionsfont{\hspace*{5pt}}
  \setlist[itemize]{itemsep=-3pt}
  \titlespacing\section{0pt}{12pt plus 4pt minus 2pt}{1pt plus 2pt minus 2pt}
  \titleformat\section{\normalfont\large\bfseries\sffamily\scshape}{
    \thesection}{1em}{}[\thinlinesplit]
  \titlespacing\subsection{0pt}{12pt plus 4pt minus 2pt}{4pt plus 2pt minus 2pt}
  \titleformat\subsection[runin]{\normalfont\sffamily\bfseries}{\thesection}{1em}{}
  \titlespacing\subsubsection{0pt}{12pt plus 4pt minus 2pt}{1pt plus 2pt minus 2pt}
  \setlength\parindent{0pt}}

\newcommand{\etherealtext}[1]{
  \textcolor{gray}{\textit{{\fontfamily{qag}\selectfont #1}}}}

% math commands
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\DeclareMathOperator*{\argmin}{arg\!min}
\DeclareMathOperator*{\argmax}{arg\!max}
\DeclareMathOperator*{\arginf}{arg\!inf}
\DeclareMathOperator*{\argsup}{arg\!sup}
\DeclareMathOperator*{\capac}{cap}
\DeclareMathOperator*{\val}{val}
\DeclareMathOperator*{\im}{Im}
\DeclareMathOperator*{\length}{length}
\newcommand{\sqprod}{\mathbin{\text{\scalebox{.84}{$\square$}}}}
\newcommand{\makeseq}[1]{\{#1\}_{i = 1}^\infty}
\newcommand{\overbar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}
\newcommand{\disjointunion}{\coprod}
\renewcommand{\qedsymbol}{\rule{0.7em}{0.7em}}
\newcommand{\ball}[2]{B(#1,#2)}
\newcommand{\cball}[2]{\overbar{B}(#1,#2)}
\newcommand{\e}{\epsilon}
\newcommand{\de}{\delta}
\newcommand{\co}{\backslash}
% space after common math symbols
\let\oldexists\exists
\renewcommand{\exists}{\,\oldexists\,}
\newcommand{\existsuniq}{\exists!\,}
\let\oldnexists\nexists
\renewcommand{\nexists}{\,\oldnexists\,}
\newcommand{\st}{\,\,s.t.\,\,}
\let\oldforall\forall
\renewcommand{\forall}{\,\oldforall\,}
\newcommand{\pipe}{\,|\,}
\newcommand{\bigfrac}[2]{\bigg(\frac{#1}{#2}\bigg)}
\newcommand{\myeqref}[1]{\begin{normalfont}{(\ref{#1})}\end{normalfont}}
\newcommand{\eqr}[1]{\myeqrefp{#1}}
% adds parens to within the link
\newcommand{\myeqrefp}[1]{\begin{normalfont}{\hyperref[#1]{(\ref*{#1})}}\end{normalfont}}
\newcommand{\abs}[1]{\lvert #1 \rvert}
\newcommand{\scr}[1]{\mathcal{#1}}
% parentheses! \p[size]{<content>}; e.g. \p[\bigg]{sup} or \p{sup}
\newcommand{\p}[2][]{#1(#2#1)}
\newcommand{\vect}[2]{
  \begin{bmatrix}
    #1 \\ #2
  \end{bmatrix}
}
\newcommand{\vecth}[3]{
  \begin{bmatrix}
    #1 \\ #2 \\ #3
  \end{bmatrix}
}
\newcommand{\rst}[2]{#1\restriction_{#2}}

% si setup default
\sisetup{per-mode = symbol}

% size section headings
\newcommand{\sizesections}[1]{
  \titleformat{\section}
  {\normalfont\fontsize{#1}{#1}\bfseries}{\thesection}{1em}{}
}

% allow row resizing of matrices (https://tex.stackexchange.com/questions/14071/how-can-i-increase-the-line-spacing-in-a-matrix)
\makeatletter
\renewcommand*\env@matrix[1][\arraystretch]{%
  \edef\arraystretch{#1}%
  \hskip -\arraycolsep
  \let\@ifnextchar\new@ifnextchar
  \array{*\c@MaxMatrixCols c}}
\makeatother

\newcommand{\txt}[2][\,\,]{#1\text{#2}#1}

% resize rows of tabular (https://tex.stackexchange.com/questions/31672/column-and-row-padding-in-tables)
\newenvironment{resizearray}[1]{
  \bgroup
  \def\arraystretch{#1}
}{
  \egroup
}

\newenvironment{desc}{\begin{description}[style=nextline]}{\end{description}}
\newcommand\parenref[1]{(\nameref{#1})}
\newcommand\note[2][<]{
  \textbf{#1#2}
}

\NewDocumentCommand{\deffo}{m o +g}{
  \item[#1] \IfValueT{#2}{#2}
    \IfValueT{#3}{\hfill \\ #3}
}
